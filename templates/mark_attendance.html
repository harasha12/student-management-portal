<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mark Attendance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        h2 { text-align: center; font-weight: 600; margin-bottom: 25px; }
        .attendance-box {
            background: #fff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            max-width: 1000px;
            margin: 40px auto;
        }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #dee2e6; text-align: center; padding: 10px; }
        th { background: #e9ecef; }
        .form-inline { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; margin-bottom: 20px; }
        .form-inline select, .form-inline input { flex: 1; min-width: 150px; }
        .btn { margin-top: 10px; }
    </style>
</head>
<body>
<div class="attendance-box">
    <h2>üìù Mark Attendance</h2>

    <!-- Filters Form -->
    <form id="filterForm" class="form-inline">
        <input type="date" id="datePicker" name="date" class="form-control" required>

        <select id="yearSelect" class="form-select" required>
            <option value="">Select Year</option>
            <option value="1/4">1/4</option>
            <option value="2/4">2/4</option>
            <option value="3/4">3/4</option>
            <option value="4/4">4/4</option>
        </select>

        <select id="branchSelect" class="form-select" required>
            <option value="">Select Branch</option>
            <option value="B.Tech - CSE">B.Tech - CSE</option>
            <option value="B.Tech - IT">B.Tech - IT</option>
            <option value="B.Tech - Civil">B.Tech - Civil</option>
            <option value="B.Tech - Mech">B.Tech - Mech</option>
            <option value="B.Tech - EEE">B.Tech - EEE</option>
            <option value="B.Tech - ECE">B.Tech - ECE</option>
            <option value="B.Tech - CSC">B.Tech - CSC</option>
            <option value="B.Tech - AI & ML">B.Tech - AI & ML</option>
            <option value="B.Tech - AI & DS">B.Tech - AI & DS</option>
        </select>
    </form>

    <!-- Attendance Table (Hidden until filters selected) -->
    <div id="attendanceTable" style="display: none;">
        <form method="POST">
            <!-- Period Selection -->
            <div class="mb-3">
                <label for="periodDropdown" class="form-label">Select Period</label>
                <select class="form-select" id="periodDropdown" name="selected_period">
                    <option value="">-- Choose Period --</option>
                    {% for i in range(1, 8) %}
                        <option value="{{ i }}">Period {{ i }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Lab Periods Checkboxes -->
            <div class="mb-4">
                <label class="form-label">Select Lab Periods</label>
                <div class="row">
                    {% for i in range(1, 8) %}
                    <div class="col-md-2 col-4">
                        <input type="checkbox" class="form-check-input lab-period" id="lab{{ i }}" name="lab_periods" value="Lab Period {{ i }}">
                        <label class="form-check-label" for="lab{{ i }}">Period {{ i }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Students Table -->
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Student Name</th>
                        <th id="periodHeader">Selected Period</th>
                        <th id="labPeriodHeader">Selected Lab Period(s)</th>
                        <th>Status</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td>{{ student.student_id }}</td>
                        <td>{{ student.name }}</td>
                        <td class="selected-period"></td>
                        <td class="selected-lab"></td>
                        <td>
                            <select name="status_{{ student.student_id }}" class="form-select" required>
                                <option value="Present">Present</option>
                                <option value="Absent">Absent</option>
                            </select>
                        </td>
                        <td><input type="text" name="remarks_{{ student.student_id }}" class="form-control" placeholder="Optional"></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <button type="submit" class="btn btn-success">‚úÖ Save Attendance</button>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('datePicker').value = today;

    const datePicker = document.getElementById('datePicker');
    const yearSelect = document.getElementById('yearSelect');
    const branchSelect = document.getElementById('branchSelect');
    const dropdown = document.getElementById('periodDropdown');
    const labPeriods = document.querySelectorAll('.lab-period');
    const table = document.getElementById('attendanceTable');

    function updateTable() {
        const filtersSelected = datePicker.value && yearSelect.value && branchSelect.value;
        table.style.display = filtersSelected ? 'block' : 'none';

        if(filtersSelected){
            const selectedLabs = Array.from(labPeriods)
                .filter(cb => cb.checked)
                .map(cb => cb.value);
            const rows = document.querySelectorAll('#attendanceTable tbody tr');
            rows.forEach(row => {
                row.querySelector('.selected-period').innerText = dropdown.value ? "Period " + dropdown.value : "-";
                row.querySelector('.selected-lab').innerText = selectedLabs.length ? selectedLabs.join(", ") : "-";
            });
        }
    }

    datePicker.addEventListener('change', updateTable);
    yearSelect.addEventListener('change', updateTable);
    branchSelect.addEventListener('change', updateTable);
    dropdown.addEventListener('change', updateTable);
    labPeriods.forEach(cb => cb.addEventListener('change', updateTable));

    updateTable(); // initial check
});
</script>
</body>
</html>
